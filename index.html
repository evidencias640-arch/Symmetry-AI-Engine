<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SYMMETRY AI ENGINE PRO V7 ‚Äî An√°lisis Biom√©trico y Emocional</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /*
  =======================================================
  ESTILOS BASE Y VARIABLES (V7 - M√°s Intensidad)
  =======================================================
  */
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Inter:wght@300;600&display=swap');
  :root{
    --ia:#00ffff; /* Cian principal */
    --ia-light:#66ffff;
    --ia-glow: 0 0 10px var(--ia), 0 0 20px rgba(0,255,255,0.6);
    --bg:#000b11;
    --muted:#a0a9b5;
    --accent-error:#ff5050;
    --accent-warning:#ffaa00;
    --accent-success:#00ffb3;
    --shadow-light: 0 0 8px var(--ia), 0 0 12px var(--ia-light);
  }

  body,html{
    margin:0;padding:0;width:100%;height:100%;background:var(--bg);
    color:#e6f9ff;font-family:Inter,Arial,sans-serif;overflow:hidden;
  }
  #main{position:relative;width:100%;height:100vh;overflow:hidden;}

  /*
  =======================================================
  VIDEO Y CANVAS: EFECTO DE ESCANER DIN√ÅMICO
  =======================================================
  */
  #webcam-feed,#capture-canvas{
    position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;
  }
  #capture-canvas{
    box-shadow: var(--ia-glow) inset;
    border: 2px solid rgba(0,255,255,0.4);
    animation: scan-glitch-v7 8s infinite alternate; /* Animaci√≥n m√°s r√°pida */
  }

  /* Animaci√≥n de Glitch/Escaneo m√°s visible */
  @keyframes scan-glitch-v7 {
    0% { clip: rect(4px, 9999px, 8px, 0); opacity: 1; }
    25% { transform: skewX(0.8deg); clip: rect(80px, 9999px, 84px, 0); opacity: 0.95; }
    50% { transform: skewX(-0.8deg); clip: rect(150px, 9999px, 154px, 0); opacity: 1; }
    75% { transform: skewX(0.4deg); clip: rect(220px, 9999px, 224px, 0); opacity: 0.9; }
    100% { clip: rect(4px, 9999px, 8px, 0); opacity: 1; }
  }

  /*
  =======================================================
  HUD / INTERFAZ DE RESULTADOS (Responsivo Mejorado)
  =======================================================
  */
  #results{
    position:absolute;
    top:10px;
    right:10px;
    background:rgba(0,0,0,0.85);
    border: 2px solid rgba(0,255,255,0.3);
    padding:16px 20px;
    border-radius:8px;
    font-size:14px;
    z-index:10;
    backdrop-filter:blur(12px);
    box-shadow: var(--ia-glow); /* Resplandor m√°s fuerte */
    max-width: 320px;
    transition: all 0.3s ease;
  }

  .metric-label{
    font-family: Orbitron, Inter, Arial;
    font-weight: 800;
    color: var(--ia-light);
    margin-top: 15px;
    text-shadow: 0 0 8px rgba(0,255,255,0.5);
    border-bottom: 2px solid rgba(0,255,255,0.2);
    padding-bottom: 4px;
    letter-spacing: 1px;
    font-size: 0.9em;
  }

  #score{
    font-family:Orbitron,Inter,Arial;font-size:42px;font-weight:800;
    line-height: 1;
    margin-top: 8px;
    color: var(--ia-light);
    text-shadow: var(--ia-glow);
  }

  /* Barra de progreso de Simetr√≠a (ISF) */
  #progress{
    width:100%;height:10px;background:#001;border-radius:999px;
    overflow:hidden;margin-top:8px;
    box-shadow: 0 0 8px rgba(0,255,255,0.4) inset;
  }
  #progress>div{
    height:100%;
    width:0%;
    transition:width .8s ease, background .8s;
    box-shadow: 0 0 8px rgba(0,255,255,1);
    animation: pulse-glow 2s infinite alternate; /* Animaci√≥n de pulsaci√≥n */
  }

  @keyframes pulse-glow {
    from { opacity: 0.7; }
    to { opacity: 1; }
  }

  #score-feedback{
    font-size: 15px;
    margin-top: 6px;
    color: var(--ia-light);
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  /* Estilos de Expresi√≥n */
  #expr-all{
    color: var(--muted);
    font-size: 11px;
    line-height: 1.4;
    margin-top: 8px;
    word-break: break-all;
  }

  /*
  =======================================================
  CONTROLES / BOTONES (Mejor Responsividad)
  =======================================================
  */
  #controls{
    position:absolute;bottom:10px;left:50%;transform:translateX(-50%);
    display:flex;gap:15px;z-index:20;flex-wrap:wrap;justify-content:center;
  }
  .btn{
    background:rgba(0,0,0,0.8);
    border:2px solid rgba(0,255,255,0.4);
    color:var(--ia);
    padding:14px 22px;
    border-radius:12px;
    cursor:pointer;
    backdrop-filter:blur(10px);
    font-weight:700;
    transition:background .3s, transform .2s, box-shadow .3s;
    font-family: Orbitron, Inter, Arial;
    letter-spacing: 1.5px;
    font-size: 16px;
    box-shadow: 0 0 5px rgba(0,255,255,0.3);
  }
  .btn:hover:not(:disabled){
    background:rgba(0,255,255,0.25);
    box-shadow: var(--ia-glow);
    transform: translateY(-3px) scale(1.02);
  }
  .primary{
    background:linear-gradient(90deg,var(--ia-dark),var(--ia));
    color:#000;
    text-shadow: 0 0 2px #000;
    border-color: var(--ia-light);
  }

  /*
  =======================================================
  CAPA DE ANALISIS (ANIMACI√ìN PROFESIONAL)
  =======================================================
  */
  #analysis-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.98);
    z-index: 25;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--ia);
    font-family: Orbitron, Inter, Arial;
    text-shadow: var(--ia-glow);
    letter-spacing: 3px;
  }
  #analysis-overlay.active {
    display: flex;
    animation: glitch-bg 0.5s infinite alternate;
  }
  #analysis-overlay h3 {
    font-size: 2.5em;
    margin-bottom: 30px;
    text-align: center;
    line-height: 1.2;
  }
  #analysis-progress-bar {
    width: 80%; /* Responsivo */
    max-width: 400px;
    height: 12px;
    background: rgba(0, 255, 255, 0.1);
    border: 2px solid var(--ia);
    overflow: hidden;
    margin-top: 15px;
    box-shadow: var(--ia-glow);
  }
  #analysis-progress-bar > div {
    height: 100%;
    width: 0%;
    background: var(--ia);
    transition: width 0.1s linear;
  }
  /* Glitch m√°s fuerte */
  @keyframes glitch-bg {
    0% { transform: translate(0); clip: rect(10px, 9999px, 14px, 0); }
    20% { transform: translate(-2px, 2px); clip: rect(50px, 9999px, 54px, 0); }
    40% { transform: translate(2px, -2px); clip: rect(100px, 9999px, 104px, 0); }
    60% { transform: translate(-1px, 1px); clip: rect(150px, 9999px, 154px, 0); }
    80% { transform: translate(1px, -1px); clip: rect(200px, 9999px, 204px, 0); }
    100% { transform: translate(0); clip: rect(250px, 9999px, 254px, 0); }
  }


  /*
  =======================================================
  MEDIA QUERIES (RESPONSIVIDAD M√ìVIL CR√çTICA) üì±
  =======================================================
  */
  @media(max-width:768px){
    /* Mueve resultados al centro/abajo para no obstruir la vista principal */
    #results{
      top: auto;
      bottom: 70px; /* Sobre los controles, para no chocarse */
      right: 50%;
      transform: translateX(50%);
      width: 95%;
      max-width: 400px; /* Limita el ancho en tabletas */
      padding: 12px 16px;
      font-size: 13px;
      margin-bottom: 50px;
    }
    #score{font-size:32px;}
    .metric-label{font-size: 0.85em; margin-top: 10px;}
    #score-feedback{font-size: 13px;}
    #expr-all{font-size: 10px; line-height: 1.3;}

    #controls{
      bottom: 4px;
      gap: 8px;
      width: 100%;
    }
    .btn{
      padding:10px 14px;
      font-size: 13px;
      letter-spacing: 1px;
      border-radius: 8px;
    }
    #analysis-overlay h3 {
      font-size: 1.8em;
      margin-bottom: 20px;
    }
    #analysis-progress-bar {
      width: 90%;
      height: 10px;
    }
  }

  @media(max-width:400px){
    /* Adaptaci√≥n extrema para smartphones peque√±os */
    .btn{
      padding: 8px 10px;
      font-size: 11px;
    }
    #results {
      bottom: 50px; /* Asegura espacio para controles */
    }
  }
</style>
</head>
<body>
<div id="main">
  <video id="webcam-feed" autoplay muted playsinline></video>
  <canvas id="capture-canvas"></canvas>

  <div id="placeholder">
    <h2 style="color:var(--ia)">SYMMETRY AI ENGINE V7 ‚Äî M√ìDULO INACTIVO</h2>
    <p style="color:var(--muted)">Procesador de Imagen Desconectado. Active la c√°mara y presione <strong>INICIAR DETECCI√ìN</strong>.</p>
  </div>

  <div id="results">
    <div><b>DETECCIONES ACTIVAS:</b> <span id="count">0</span></div>

    <div class="metric-label">√çNDICE DE SIMETR√çA FACIAL (ISF)</div>
    <div id="score">‚Äî</div>
    <div id="progress"><div></div></div>
    <div id="score-feedback" style="margin-top:4px;">Inicie el an√°lisis biom√©trico.</div>

    <div class="metric-label">AN√ÅLISIS EMOCIONAL PREDOMINANTE</div>
    <div id="expr" style="margin-top:6px;color:var(--muted)">Dominante: <span id="expr-dominant">‚Äî</span></div>
    <small id="expr-all"></small>
  </div>

  <div id="analysis-overlay">
    <h3>[ AN√ÅLISIS BIOM√âTRICO AVANZADO EN CURSO ]</h3>
    <div id="analysis-progress-bar">
      <div></div>
    </div>
    <p id="analysis-status" style="margin-top: 20px; font-size: 16px; letter-spacing: 2px;">Conectando a servidores neuronales...</p>
  </div>

  <div id="controls">
    <button id="start" class="btn" disabled>‚ñ∂ INICIAR DETECCI√ìN</button>
    <button id="capture" class="btn primary" disabled>üì∏ CAPTURAR Y CONGELAR</button>
    <button id="analyze" class="btn" style="display:none">‚öôÔ∏è ANALIZAR AVANZADO</button>
    <button id="retry" class="btn" style="display:none">üîÑ REANUDAR WEBCAM</button>
    <button id="download" class="btn" style="display:none">‚¨áÔ∏è DESCARGAR REPORTE</button>
  </div>
</div>

<script src="./face-api.min.js"></script>
<script>
/*
=======================================================
JAVASCRIPT/FACE-API.JS L√ìGICA (OPT.)
=======================================================
*/
const MODELS_URL='./models';
// Elementos DOM
const video=document.getElementById('webcam-feed');
const canvas=document.getElementById('capture-canvas');
const ctx=canvas.getContext('2d',{willReadFrequently:true});
const placeholder=document.getElementById('placeholder');
const btnStart=document.getElementById('start');
const btnCapture=document.getElementById('capture');
const btnAnalyze=document.getElementById('analyze');
const btnRetry=document.getElementById('retry');
const btnDownload=document.getElementById('download');
const countEl=document.getElementById('count');
const scoreEl=document.getElementById('score');
const progressBar=document.querySelector('#progress>div');
const scoreFeedbackEl=document.getElementById('score-feedback');
const exprDominantEl=document.getElementById('expr-dominant');
const exprAllEl=document.getElementById('expr-all');
const analysisOverlay=document.getElementById('analysis-overlay');
const analysisProgressBar=document.querySelector('#analysis-progress-bar>div');
const analysisStatusEl=document.getElementById('analysis-status');

// Variables de estado
let running=false,raf=null,captured=null;

// Traducciones de expresiones m√°s profesionales
const EXPR_TRADS = {
    'neutral': 'Neutralidad (Estado Base)',
    'happy': 'Satisfacci√≥n / Alegr√≠a',
    'sad': 'Melancol√≠a / Tristeza',
    'angry': 'Ira / Agitaci√≥n',
    'fearful': 'Temor / Ansiedad',
    'disgusted': 'Disgusto / Repulsi√≥n',
    'surprised': 'Sorpresa / Asombro'
};

//=== Init models
async function loadModels(){
  btnStart.textContent = '[ Carga IA 0% ]';
  await Promise.all([
    faceapi.nets.ssdMobilenetv1.loadFromUri(MODELS_URL).then(() => btnStart.textContent = '[ Carga IA 33% ]'),
    faceapi.nets.faceLandmark68Net.loadFromUri(MODELS_URL).then(() => btnStart.textContent = '[ Carga IA 66% ]'),
    faceapi.nets.faceExpressionNet.loadFromUri(MODELS_URL).then(() => btnStart.textContent = '[ Carga IA 100% ]')
  ]);
  btnStart.textContent = '‚ñ∂ INICIAR DETECCI√ìN';
  btnStart.disabled=false;
}
window.addEventListener('load',loadModels);

//=== Start camera
btnStart.onclick=async()=>{
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:true});
    video.srcObject=stream; await video.play();
    placeholder.style.display='none';
    btnStart.style.display='none';
    btnCapture.disabled=false;
    resizeCanvas(); running=true; loop();
  }catch(e){alert('Error al acceder a la c√°mara: '+e.message);}
};

//=== Resize canvas to full screen
function resizeCanvas(){
  // Asegura que el canvas siempre tome la dimensi√≥n del video o de la ventana (para m√≥viles)
  canvas.width=video.videoWidth||window.innerWidth;
  canvas.height=video.videoHeight||window.innerHeight;
}
window.addEventListener('resize',resizeCanvas);

//=== Live detection loop
async function loop(){
  if(!running)return;
  resizeCanvas();
  const det=await faceapi.detectAllFaces(video,new faceapi.SsdMobilenetv1Options({minConfidence:.5}))
    .withFaceLandmarks().withFaceExpressions();

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  const resized=faceapi.resizeResults(det,{width:canvas.width,height:canvas.height});

  // Estilo de dibujado m√°s profesional y sutil para la detecci√≥n en vivo
  const drawOptions = {
      boxColor: 'rgba(0, 255, 255, 0.7)',
      lineWidth: 2,
      label: 'BIOMETR√çA ACTIVA'
  };
  faceapi.draw.drawDetections(canvas,resized, drawOptions);
  faceapi.draw.drawFaceLandmarks(canvas,resized);

  countEl.textContent=det.length;

  if(det.length > 0){
    const score=calcSymmetry(det[0]);
    updateScoreDisplay(score);
    updateProgressColor(score);
    updateEmotionDisplay(det[0].expressions);
    progressBar.style.width='30%';
    scoreFeedbackEl.textContent = 'Detecci√≥n R√ÅPIDA en tiempo real. Capture para an√°lisis completo.';
  } else {
    resetHUDLive();
  }

  raf=requestAnimationFrame(loop);
}

//=== Capture image
btnCapture.onclick=()=>{
  if(parseInt(countEl.textContent) === 0){
    alert('ALERTA: Se requiere un rostro detectado para el proceso de captura.');
    return;
  }
  running=false; cancelAnimationFrame(raf); video.pause();
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  captured=canvas.toDataURL('image/png');

  btnCapture.style.display='none';
  btnAnalyze.style.display='inline-block';
  btnRetry.style.display='inline-block';
  btnDownload.style.display='inline-block';
  btnAnalyze.disabled=false;

  scoreFeedbackEl.textContent = 'IMAGEN CONGELADA. Listo para An√°lisis Avanzado.';
  progressBar.style.width='5%';
  scoreEl.textContent = '‚Äî';
};

//=== Analyze captured
btnAnalyze.onclick=async()=>{
  if(!captured){alert('Error cr√≠tico: Sin captura.');return;}
  btnAnalyze.disabled=true;
  btnRetry.disabled=true;
  btnDownload.disabled=true;

  // Mostrar la animaci√≥n de an√°lisis m√°s intensa
  analysisOverlay.classList.add('active');
  const totalDelay = 3500; // 3.5 segundos de simulaci√≥n de an√°lisis
  analysisStatusEl.textContent = 'Iniciando conexi√≥n neural... [0%]';

  // Array de pasos para simular el an√°lisis profesional
  const analysisSteps = [
    { status: 'Cargando matriz de imagen en buffer. Iniciando algoritmos de segmentaci√≥n...', progress: 15, delay: 500 },
    { status: 'An√°lisis Morfol√≥gico de 68 puntos clave. C√°lculo de proporciones aureas...', progress: 40, delay: 800 },
    { status: 'Procesamiento Biom√©trico: C√°lculo de √çndices de Simetr√≠a Facial (ISF)...', progress: 65, delay: 900 },
    { status: 'Evaluaci√≥n del M√≥dulo Emocional. Patrones de micro-expresiones detectados...', progress: 90, delay: 800 }
  ];

  for (const step of analysisSteps) {
    analysisStatusEl.textContent = step.status;
    analysisProgressBar.style.width = step.progress + '%';
    await new Promise(r => setTimeout(r, step.delay));
  }
  
  // EJECUCI√ìN REAL DEL AN√ÅLISIS
  const dets=await faceapi.detectAllFaces(canvas,new faceapi.SsdMobilenetv1Options({minConfidence:.5}))
    .withFaceLandmarks().withFaceExpressions();

  // Ocultar animaci√≥n
  analysisProgressBar.style.width = '100%';
  analysisStatusEl.textContent = 'AN√ÅLISIS COMPLETO. GENERANDO REPORTE FINAL...';
  await new Promise(r => setTimeout(r, 500));
  analysisOverlay.classList.remove('active');

  // 1. Dibujar resultados en el canvas
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const img=new Image(); img.src=captured; await new Promise(r=>img.onload=r);
  ctx.drawImage(img,0,0,canvas.width,canvas.height);
  const resized=faceapi.resizeResults(dets,{width:canvas.width,height:canvas.height});
  
  // Dibujar resultados de An√°lisis Final
  faceapi.draw.drawDetections(canvas,resized, {boxColor: 'var(--accent-success)', lineWidth: 3});
  faceapi.draw.drawFaceLandmarks(canvas,resized);
  faceapi.draw.drawFaceExpressions(canvas,resized, 0.05); // Mostrar expresiones con un tama√±o de fuente mayor

  // 2. Actualizar HUD
  countEl.textContent=dets.length;
  if(!dets.length){
    resetHUDAnalysisError();
    btnAnalyze.disabled=false;
    btnRetry.disabled=false;
    return;
  }

  // Calcular y mostrar Simetr√≠a/Atractivo
  const score=calcSymmetry(dets[0]);
  updateScoreDisplay(score.toFixed(2));
  updateProgressColor(score);
  updateScoreFeedback(score);
  progressBar.style.width='100%';

  // Mostrar Emociones
  updateEmotionDisplay(dets[0].expressions, true); // Pasar true para mostrar el reporte completo

  btnAnalyze.style.display='none'; // No volver a analizar el mismo
  btnRetry.disabled=false;
  btnDownload.disabled=false;
};

//=== Retry (Reanudar Webcam)
btnRetry.onclick=()=>{
  running=true; video.play();
  btnCapture.style.display='inline-block';
  btnAnalyze.style.display='none';
  btnRetry.style.display='none';
  btnDownload.style.display='none';
  btnCapture.disabled=false;
  resetHUDLive();
  raf=requestAnimationFrame(loop);
};

//=== Download capture
btnDownload.onclick=()=>{
  if(!captured)return;
  const a=document.createElement('a');
  const finalImage = canvas.toDataURL('image/png');
  a.href=finalImage;
  a.download='SYMMETRY_ANALYSIS_V7_REPORTE.png';
  a.click();
};

/*
=======================================================
HELPERS (L√ìGICA DE C√ÅLCULO Y VISUALIZACI√ìN)
=======================================================
*/

//=== Calcula la Simetr√≠a (ISF) - L√≥gica sin cambios, solo la presentaci√≥n
function calcSymmetry(det){
  try{
    const lm=det.landmarks;
    const left=centroid(lm.getLeftEye()),right=centroid(lm.getRightEye()),nose=centroid(lm.getNose()),mouth=centroid(lm.getMouth());
    const dL=dist(left,nose),dR=dist(right,nose);
    const balance=1-Math.abs(dL-dR)/Math.max(dL,dR);
    const mouthSym=1-Math.abs(mouth.x-nose.x)/(canvas.width*0.05);
    const phi=1.618;
    const ratio=(dL+dR)/(dist(left,right)||1);
    const phiScore=1-Math.abs(ratio-phi/2)/(phi/2);
    const score=Math.max(0,Math.min(100,(balance*0.5+mouthSym*0.3+phiScore*0.2)*100));
    return score;
  }catch(e){return 0;}
}
function centroid(p){return p.reduce((a,b)=>({x:a.x+b.x,y:a.y+b.y}),{x:0,y:0});}
function dist(a,b){const dx=a.x-b.x,dy=a.y-b.y;return Math.hypot(dx,dy);}

//=== Actualiza el feedback de Simetr√≠a/Atractivo (M√°s enfocado en la biometr√≠a)
function updateScoreFeedback(score){
    let feedback = '';
    let color = '';
    if(score > 90){
        feedback = 'ISF NIVEL 5 (√ìptimo): Biometr√≠a y Armon√≠a facial excepcional.';
        color = 'var(--accent-success)';
    } else if(score > 80){
        feedback = 'ISF NIVEL 4 (Superior): Alta simetr√≠a. Proporciones armoniosas.';
        color = 'var(--accent-success)';
    } else if(score > 70){
        feedback = 'ISF NIVEL 3 (Est√°ndar): Simetr√≠a adecuada. √çndice de balance promedio.';
        color = 'var(--accent-warning)';
    } else {
        feedback = 'ISF NIVEL 2 (Bajo): Se detectan desviaciones significativas en la simetr√≠a.';
        color = 'var(--accent-error)';
    }
    scoreFeedbackEl.textContent = feedback;
    scoreFeedbackEl.style.color = color;
}

//=== Actualiza la visualizaci√≥n de Emociones
function updateEmotionDisplay(expressions, fullReport = false){
  const sorted=Object.entries(expressions).sort((a,b)=>b[1]-a[1]);
  const dominant = sorted[0][0];
  const dominantPercent = (sorted[0][1]*100).toFixed(1);

  exprDominantEl.textContent = `${EXPR_TRADS[dominant]} (${dominantPercent}%)`;
  
  // Mostrar reporte completo solo despu√©s del an√°lisis avanzado
  if(fullReport){
      exprAllEl.textContent = 'Detalle: ' + sorted.map(e=>EXPR_TRADS[e[0]].split(' ')[0] + ': '+(e[1]*100).toFixed(0)+'%').join(' ¬∑ ');
  } else {
      exprAllEl.textContent = 'Detalle disponible tras An√°lisis Avanzado...';
  }
}

//=== Resetea el HUD en modo Detecci√≥n en Vivo
function resetHUDLive(){
  updateScoreDisplay('‚Äî');
  progressBar.style.width='4%';
  updateProgressColor(0);
  scoreFeedbackEl.textContent = 'Rostro no detectado. Esperando entrada biom√©trica.';
  exprDominantEl.textContent = '‚Äî';
  exprAllEl.textContent = 'Detalle disponible tras An√°lisis Avanzado...';
}

//=== Resetea el HUD en caso de error de an√°lisis
function resetHUDAnalysisError(){
    updateScoreDisplay('E-01');
    updateProgressColor(0);
    scoreFeedbackEl.textContent='ERROR CR√çTICO: No se detect√≥ rostro en la imagen est√°tica. Reanude.';
    exprDominantEl.textContent='‚Äî';
    exprAllEl.textContent='No hay datos biom√©tricos...';
    progressBar.style.width='10%';
}

//=== Animaci√≥n del n√∫mero de la puntuaci√≥n
function updateScoreDisplay(val){
  const el=document.getElementById('score');
  el.style.transform='scale(0.8)';
  setTimeout(()=>{
    el.textContent=val;
    el.style.transform='scale(1)';
  },160);
}

//=== Cambia el color de la barra de progreso
function updateProgressColor(score){
  let color = 'var(--accent-error)';
  if(score >= 80){ // Umbral m√°s estricto para 'success'
      color = 'var(--accent-success)';
  } else if(score >= 65){
      color = 'var(--accent-warning)';
  }
  progressBar.style.background=color;
  // Cambia el color del glow del contenedor para que coincida
  progressBar.parentElement.style.boxShadow = `0 0 8px ${color} inset`;
}
</script>
</body>
</html>
